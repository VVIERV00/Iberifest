<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
>
<h:head>
    <title>Panel de Administración</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
          integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay"
          crossorigin="anonymous"></link>
</h:head>
<h:body>

    <script type="text/javascript">
        PrimeFaces.locales['es'] = {
            closeText: 'Cerrar',
            prevText: 'Anterior',
            nextText: 'Siguiente',
            monthNames: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
            monthNamesShort: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
            dayNames: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],
            dayNamesShort: ['Dom', 'Lun', 'Mar', 'Mie', 'Jue', 'Vie', 'Sab'],
            dayNamesMin: ['D', 'L', 'M', 'X', 'J', 'V', 'S'],
            weekHeader: 'Semana',
            firstDay: 1,
            isRTL: false,
            showMonthAfterYear: false,
            yearSuffix: '',
            timeOnlyTitle: 'Sólo hora',
            timeText: 'Tiempo',
            hourText: 'Hora',
            minuteText: 'Minuto',
            secondText: 'Segundo',
            currentText: 'Fecha actual',
            ampm: false,
            month: 'Mes',
            week: 'Semana',
            day: 'Día',
            allDayText: 'Todo el día'
        };

        function handleLoginRequest(xhr, status, args) {
            if (args.validationFailed || !args.loggedIn) {
                PF('dlg').jq.effect("shake", {times: 5}, 100);
            } else {
                PF('dlg').hide();
                $('#loginLink').fadeOut();
            }
        }


    </script>

    <style type="text/css">
        .value {
            font-weight: bold;
        }
    </style>


    <h3 style="margin-top:0">Panel de Adminisitración</h3>


    <h:form>
        <h3>Filtrado de usuarios</h3>
        <h:panelGrid columns="4">
            <p:inputText placeholder="Username" value="#{adminController.user.username}" id="username"></p:inputText>
            <p:inputText placeholder="Email" value="#{adminController.user.email}" id="email"></p:inputText>
            <h:commandButton action="#{adminController.getByUserName()}" value="Submit"></h:commandButton>


        </h:panelGrid>
        <p:calendar id="birthday" placeholder="BirthDay" value="#{adminController.user.birthday}" showOn="button"
                    locale="es"/>
        <p:calendar id="register_date" placeholder="RegisterDate" value="#{adminController.user.register_date}"
                    showOn="button" locale="es"/>
    </h:form>
    <h:form>

        <p:dataTable id="tablaUsuarios" var="usuarios" value="#{adminController.listaUsuarios}">
            <p:column headerText="Id">
                <h:outputText value="#{usuarios.id_user}"/>
            </p:column>

            <p:column headerText="Name">
                <h:outputText value="#{usuarios.name}"/>
            </p:column>
            <p:column headerText="Email">
                <h:outputText value="#{usuarios.email}"/>
            </p:column>
            <p:column headerText="Roles">
                <ui:repeat var="rol" value="#{adminController.getRolOfUser(usuarios)}">
                    <h:outputText value="#{rol.role.name}"/>
                    <br></br>
                </ui:repeat>
            </p:column>
            <p:column headerText="Operaciones">
                <p:commandButton update="tablaUsuarios" value="Eliminar Usuario" id="eliminarUsuario"
                                 action="#{adminController.deleteUser(usuarios)}"/>

            </p:column>
            <p:column headerText="Cambiar Roles" width="350">
                <ui:repeat var="map" value="#{adminController.auxChange(usuarios)}">
                    <p:selectManyCheckbox id="grid" value="#{map[usuarios]}" layout="grid" columns="3">
                        <f:selectItems value="#{adminController.allRoles}" var="rol" itemLabel="#{rol.name}"
                                       itemValue="#{rol.name}"/>
                    </p:selectManyCheckbox>
                    <br></br>
                </ui:repeat>
                <p:commandButton value="Modificar Roles" id="modificarRoles"
                                 action="#{adminController.changeRoleOfUser(usuarios)}"/>
            </p:column>
        </p:dataTable>

    </h:form>
    <p:button outcome="event.xhtml" value="Ir a eventos" icon="pi pi-star"
              style="margin-right:20px;">
    </p:button>


</h:body>
</html>

